<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <!-- VERSION 3 - NO FETCH - REDIRECT ONLY -->
  <title>Event QR Scanner</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
</head>

<body style="background:black;color:white;text-align:center;font-family:sans-serif">
  <h1>Scan Entry QR</h1>
  <div id="reader" style="width:300px;margin:auto"></div>

  <script>
    const SCRIPT_URL =
      "https://script.google.com/macros/s/AKfycbw2mjnx2K7jihpbgCo_bcwXTYre30XR28BCAnbistaasRFOaeYNKXOGTWPXEgBaw_Xh/exec";

    function onScanSuccess(decodedText) {
      try {
        const url = new URL(decodedText);
        const token = url.searchParams.get("token");

        if (!token) {
          alert("Invalid QR");
          return;
        }

        window.location.href = SCRIPT_URL + "?token=" + token;
      } catch (e) {
        alert("Invalid QR format");
      }
    }

    const scanner = new Html5Qrcode("reader");
    scanner.start(
      { facingMode: "environment" },
      { fps: 10, qrbox: 250 },
      onScanSuccess
    );
  </script>
</body>
</html>
